!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";(function(t){function i(e,n){var i=document.querySelector(e);if(!i)throw new Error("Selector ".concat(e," doesn't return an element."));var r=i.getBoundingClientRect(),a=function(e,n){var i=document.createElement("canvas"),r=i.getContext("2d"),a=t.devicePixelRatio||1;return i.width=e*a,i.height=n*a,i.style.width="".concat(e,"px"),i.style.height="".concat(n,"px"),r._spriteSize=Math.ceil(.023*i.height),r.dpr=a,r}(r.width,r.height-150);return i.appendChild(a.canvas),a}n.d(e,"a",function(){return i})}).call(this,n(1))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e);var i=n(0);var r=function(){var t={jump:[38,32,87],right:[39,68],left:[37,65]},e={jump:!1,right:!1,left:!1},n=function(n){Object.keys(e).forEach(function(i){t[i].indexOf(event.keyCode)>-1&&(e[i]=n)})};return document.body.addEventListener("keydown",function(t){return n(!0)}),document.body.addEventListener("keyup",function(t){return n(!1)}),e}();var a={LEVEL_FAIL:"LEVEL_FAIL",LEVEL_COMPLETED:"LEVEL_COMPLETED",GAME_OVER:"GAME_OVER",BATTERY_UPGRADE_SML:"BATTERY_UPGRADE_SML",BATTERY_UPGRADE_MED:"BATTERY_UPGRADE_MED",BATTERY_UPGRADE_LRG:"BATTERY_UPGRADE_LRG",RETRY:"RETRY"};function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var c=function(){function t(e){var n=e.x,i=e.y,r=e.width,a=e.height,o=e.fill,c=e.context;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=n,this.y=i,this.width=r,this.height=a,this.fill=o,this.context=c}return function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(t,[{key:"collides",value:function(t){return function(t,e){var n=[t.x+t.width/2-(e.x+e.width/2),t.y+t.height/2-(e.y+e.height/2)],i=[t.width/2+e.width/2,t.height/2+e.height/2];if(Math.abs(n[0])<i[0]&&Math.abs(n[1])<i[1]){var r=[i[0]-Math.abs(n[0]),i[1]-Math.abs(n[1])];return r[0]>=r[1]?n[1]>0?["top",r[1]]:["bottom",-r[1]]:n[0]>0?["left",r[0]]:["right",-r[0]]}return[null,null]}(t,this)}},{key:"draw",value:function(){this.context.fillStyle=this.fill,this.x-=this.speed||1,this.context.fillRect(this.x,this.y,this.width,this.height)}}]),t}();var s=function(t){return{player:{x:0,y:0,width:25,height:25,speed:3,hspeed:t.dpr>1?4:3,v:{x:0,y:0},jump:!1,grnd:!1,batteryLife:1,draw:function(){t.fillStyle="lightblue",this.jump&&(t.fillStyle="orange"),t.fillRect(this.x,this.y,this.width,this.height)},getBatteryLife:function(){return this._lastChecked?Date.now()-this._lastChecked>1e4&&(this._lastChecked=Date.now(),this.batteryLife>.1&&function(t){var e=t.batteryLife-.3;!function n(){if(t.cancelDecay)return t.cancelDecay=!1;t.batteryLife-=.001,t.batteryLife>e&&requestAnimationFrame(n)}()}(this)):this._lastChecked=Date.now(),this.batteryLife},increaseBattery:function(t){this.cancelDecay=!0,this._lastChecked=Date.now(),this.batteryLife=Math.min(this.batteryLife+t,1)}},obstacle:function(e,n,i,r){return new c({x:e,y:n,width:i,height:r,fill:"#212121",context:t})},endSuccess:function(e,n,i,r){return new c({x:e,y:n,width:i,height:r,fill:"#f00",context:t})},deadzone:function(e,n,i,r){var a=new c({x:e,y:n,width:i,height:r,fill:"#f00",context:t});return a.deadzone=!0,a},batteryPack:function(e,n,i,r){var a=new c({x:e,y:n,width:i,height:r,fill:"#388E3C",context:t});return a.collected=!1,a.power=.3,a},enemy:function(e,n,i,r){var a=["#D32F2F","#F44336"][Math.floor(2*Math.random())],o=new c({x:e,y:n,width:i,height:r,fill:a,context:t});return o.origin={x:e,y:n},o.speed=5*Math.random(),o},door:function(e,n,i,r){return new c({x:e,y:n,width:i,height:r,fill:"purple",context:t})}}},l=[["                  #                       %            $"," ***  ** ***  ** ***  ** ***  ** ***  ** ***  ** ***  **","                      %             %                   ","** ******  **** **  ****** ******  ****. * ******* *****","    #         %                                         ","******  ** **  ***   **** ***  *      ***    ***   *****","    #         %                                         ","** ***  ** ******* ******* ***  * ***     ** ***   *****","      **          **    %              #         %      ","***** *  *** ******* ******* **  *** *******  ******* **","                  #                       %             "," ***  ** ***  ** ***  ** ***  ** ***  ** ***  ** ***  **","                      %             %                   ","** ******  **** **  ****** ******  ****. * ******* *****","    #         %                                         ","******  ** **  ***   **** ***  *      ***    ***   *****","    #         %                                         ","** ***  ** ******* ******* ***  * ***     ** ***   *****"," P                **    %              #         %      ","***** *  *** ******* ******* **  *** *******  ******* **"],["                                                        ","                                                        ","                                                        ","                                                        ","********************************************************"," P                                 $                     ","********************************************************","                                                        ","                                                        ","                                                        ","                                                        "],["                  #                       %            $"," ***  ** ***  ** ***  ** ***  ** ***  ** ***  ** ***  **","                      %             %                   ","** ******  **** **  ****** ******  ****. * ******* *****","    #         %                                         ","******  ** **  ***   **** ***  *      ***    ***   *****","    #         %                                         ","** ***  ** ******* ******* ***  * ***     ** ***   *****"," P    **          **    %              #         %      ","***** *  *** ******* ******* **  *** *******  ******* **"],["                  #                       %            $"," ***  ** ***  ** ***  ** ***  ** ***  ** ***  ** ***  **","                      %             %                   ","** ******  **** **  ****** ******  ****. * ******* *****","    #         %                                         ","******  ** **  ***   **** ***  *      ***    ***   *****","    #         %                                         ","** ***  ** ******* ******* ***  * ***     ** ***   *****"," P    **          **    %              #         %      ","***** *  *** ******* ******* **  *** *******  ******* **"],["                  #                       %            $"," ***  ** ***  ** ***  ** ***  ** ***  ** ***  ** ***  **","                      %             %                   ","** ******  **** **  ****** ******  ****. * ******* *****","    #         %                                         ","******  ** **  ***   **** ***  *      ***    ***   *****","    #         %                                         ","** ***  ** ******* ******* ***  * ***     ** ***   *****"," P    **          **    %              #         %      ","***** *  *** ******* ******* **  *** *******  ******* **"]],h=function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=l[i],a=s(e),o=a.player,c=a.obstacle,h=a.deadzone,u=a.batteryPack,f=a.enemy,d=a.door,v=[],y=[],p=[],g=0,w=e._spriteSize,m=Math.floor(t.height/r.length);r.forEach(function(t,e){var i=e*m;t.split("").forEach(function(t,e){var r=e*m;switch(t){case"*":v.push(c(r,i,m,w));break;case"%":y.push(f(r,i,w,w));break;case"#":p.push(u(r,i,w,w)),g++;break;case"$":n=d(r,i,w,w);break;case"P":o.x=r,o.y=i,o.width=o.height=w}})});for(var E=-5;E<r[i].length+5;E++)v.push(h(E*m,t.height+50,m,1));return{obstacles:v,monsters:y,powerups:p,player:o,end:n,totalPowerups:g,collectedPowerups:0}};h.levels=l;var u=h,f={play:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=new AudioContext,i=n.createGain();for(var r in t){var a=n.createOscillator();t[r]&&(a.connect(i),i.connect(n.destination),a.start(r*e),a.frequency.setValueAtTime(440*Math.pow(1.06,13-t[r]),r*e),a.type="triangle",i.gain.setValueAtTime(1,r*e),i.gain.setTargetAtTime(1e-4,r*e+.08,.005),a.stop(r*e+.09))}},jump:function(){this.play([25])},win:function(){this.play([25,20,15])},powerup:function(){this.play([13,12,11,10],.08)},die:function(){this.play([13,14,15,,16,17,18,,19,20,21],.2)}},d={bubbles:!0,cancellable:!0};function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d;if("function"==typeof window.CustomEvent)t.dispatchEvent(new Event(e));else{var i=n.bubbles,r=n.cancellable,a=document.createEvent("CustomEvent");a.initEvent(e,i,r),t.dispatchEvent(a)}}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,c=t[Symbol.iterator]();!(i=(o=c.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==c.return||c.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hud=n,this.lives=3,this.views={battery:document.getElementById("battery"),currentLevel:document.getElementById("currentLevel"),lives:document.getElementById("lives"),powerups:document.getElementById("collected-powerups")},this.context=e,this.canvas=e.canvas,this.currentLevel=0,this.canvas.addEventListener(a.LEVEL_COMPLETE,function(){i.currentLevel++,i.currentLevel===u.levels.length||i.startLevel()}),this.canvas.addEventListener(a.LEVEL_FAIL,function(){i.lives--,-1===i.lives?v(i.canvas,a.GAME_OVER):i.startLevel()}),this.friction=.8,this.jumpHeight=this.context._spriteSize/10,this.gravity=this.context._spriteSize/100,this.startLevel()}return function(t,e,n){e&&g(t.prototype,e),n&&g(t,n)}(t,[{key:"startLevel",value:function(){this.game=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){p(t,e,n[e])})}return t}({},u(this.canvas,this.context,this.currentLevel))}},{key:"start",value:function(){this.run=!0,this.loop()}},{key:"stop",value:function(){this.run=!1}},{key:"updateHUD",value:function(){var t=this.views,e=t.battery,n=t.currentLevel,i=t.lives,r=t.powerups;e.innerHTML="Battery: ".concat((100*this.game.player.getBatteryLife()).toFixed(1),"%"),n.innerHTML="Level: ".concat(this.currentLevel+1),i.innerHTML="Lives: ".concat(this.lives),r.innerHTML="Powerups: ".concat(this.game.collectedPowerups,"/").concat(this.game.totalPowerups)}},{key:"loop",value:function(){var t=this,e=this.game,n=e.player,i=e.obstacles,o=e.powerups;e.monsters;!1!==this.run&&(this.updateHUD(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.globalAlpha=1,this.context.fillStyle="#000000",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.globalAlpha=n.getBatteryLife(),this.context.fillStyle="#121212",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),r.jump&&!n.jump&&n.grnd&&(n.jump=!0,n.grnd=!1,n.v.y=-n.speed*this.jumpHeight,f.jump()),r.right&&n.v.x<n.hspeed&&n.v.x++,r.left&&n.v.x>-n.hspeed&&n.v.x--,n.v.x*=this.friction,n.v.y+=this.gravity,n.grnd=!1,i.forEach(function(e){var i=y(e.collides(n),2),r=i[0],o=i[1];"left"===r||"right"===r?(n.v.x=0,n.jump=!1,n.x+=o):"bottom"===r?(n.grnd=!0,n.jump=!1,n.y+=o):"top"===r&&(n.v.y*=-1,n.y+=o),e.draw(),null!==r&&e.deadzone&&v(t.canvas,a.LEVEL_FAIL)}),n.grnd&&(n.v.y=0),n.x+=n.v.x,n.y+=n.v.y,n.draw(),o.forEach(function(e){!1===e.collected&&(e.collides(n)[0]?(n.increaseBattery(e.power),e.collected=!0,t.game.collectedPowerups++,t.game.collectedPowerups===t.game.totalPowerups&&t.lives++,f.powerup()):e.draw())}),this.game.monsters.forEach(function(e){y(e.collides(n),1)[0]&&v(t.canvas,a.LEVEL_FAIL),y(e.collides({x:0,y:0,width:t.canvas.width,height:t.canvas.height}),1)[0]||(e.x=e.origin.x,e.y=e.origin.y),e.draw()}),this.game.end.collides(n)[0]?(f.win(),v(this.canvas,a.LEVEL_COMPLETE)):this.game.end.draw(),requestAnimationFrame(this.loop.bind(this)))}}]),t}(),m={start:function(){this.context=Object(i.a)("#gameStage"),this.canvas=this.context.canvas;var t=document.getElementById("hud");this.engine=new w(this.context,t),this._gameFailSequence=this.gameFailSequence.bind(this),this.canvas.addEventListener(a.GAME_OVER,this._gameFailSequence),this.engine.start()},gameFailSequence:function(){this.canvas.removeEventListener(a.GAME_OVER,this._gameFailSequence),f.die(),this.engine.stop(),setTimeout(function(){return window.location.reload()},3e3)},frame:function(){this.engine.start(),this.engine.stop()}};window.game=m,m.start()}]);